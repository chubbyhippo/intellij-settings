"p Enable NERDTree file explorer integration
set NERDTree

" Share system clipboard with IdeaVim
set clipboard+=unnamedplus

" Use IDE-aware join behavior
set ideajoin

" Case-insensitive search by default...
set ignorecase
" ...but become case-sensitive if the pattern contains uppercase letters
set smartcase

" Show absolute + relative line numbers
set number
set relativenumber

" Enable various UX plugins
set peekaboo          " Show registers on `"` / `@`
set quickscope        " Highlight f/F/t/T targets
set sneak             " Enhanced motion (s / S)
set surround          " Text objects for surroundings like (), "", etc.
set visualbell        " Use visual bell instead of audible

" Which-Key style popup for <leader> mappings
set which-key
set notimeout
" Which-Key group descriptions for leader prefixes
let g:WhichKeyDesc_dot = "<leader>. Settings..."
let g:WhichKeyDesc_a = "<leader>a Activate..."
let g:WhichKeyDesc_c = "<leader>c Config, Call, Collapse, Clear, Change..."
let g:WhichKeyDesc_e = "<leader>e Extract, Edit..."
let g:WhichKeyDesc_f = "<leader>f Format, Find..."
let g:WhichKeyDesc_g = "<leader>g Git, Generate, Goto..."
let g:WhichKeyDesc_i = "<leader>i Inline, Introduce, Id..."
let g:WhichKeyDesc_l = "<leader>l LocalHistory..."
let g:WhichKeyDesc_m = "<leader>m Mode..."
let g:WhichKeyDesc_n = "<leader>n New..."
let g:WhichKeyDesc_o = "<leader>o Open, Optimize, Override..."
let g:WhichKeyDesc_p = "<leader>p Popup, Project..."
let g:WhichKeyDesc_r = "<leader>r Refactorings, Run ..."
let g:WhichKeyDesc_s = "<leader>s Search, Stop, Show, Surround, Source..."
let g:WhichKeyDesc_t = "<leader>t Toggle..."
let g:WhichKeyDesc_v = "<leader>v Vcs..."
" Prefix used by Which-Key for comment-related mappings
let g:WhichKeyDesc_commentray_prefix = "j"

" Insert mode: jj quickly returns to Normal mode
imap jj <Esc>

" Multiple cursors plugin configuration
set multiple-cursors
" Add next occurrence (normal/visual)
map <c-n> <Plug>NextWholeOccurrence
xmap <c-n> <Plug>NextWholeOccurrence
" Add next occurrence (word-wise)
map g<c-n> <Plug>NextOccurrence
xmap g<c-n> <Plug>NextOccurrence
" Skip/remove occurrences in visual mode
xmap <c-x> <Plug>SkipOccurrence
xmap <c-p> <Plug>RemoveOccurrence
" Select all whole occurrences
map <c-s-n> <Plug>AllWholeOccurrences
xmap <c-s-n> <Plug>AllWholeOccurrences

" Control-key handler routing: whether keys go to IDE or Vim
" a - all modes, n - normal, i - insert, v - visual
sethandler <c-a> a:ide
sethandler <c-b> a:ide
sethandler <c-c> i-v:vim
sethandler <c-d> i:ide
sethandler <c-e> a:vim
sethandler <c-f> a:ide
sethandler <c-h> n:vim
sethandler <c-i> a:vim
sethandler <c-j> n:vim
sethandler <c-k> n:vim
sethandler <c-l> n:vim
sethandler <c-m> a:ide
sethandler <c-n> n:vim
sethandler <c-o> a:vim
sethandler <c-p> n:vim
sethandler <c-r> a:vim
sethandler <c-u> a:vim
sethandler <c-v> a:vim
sethandler <c-w> a:ide
sethandler <c-x> a:vim
sethandler <c-[> a:vim
sethandler <c-s-n> a:vim

" Space is the leader key
let mapleader=" "

" Insert mode: Ctrl-j/k move cursor up/down (IDE-like)
imap <c-j> <down>
imap <c-k> <up>

" Keep cursor centered when moving between search results / half-page scrolls
map n nzzzv
map N Nzzzv
map <c-d> <c-d>zz
map <c-u> <c-u>zz

" Window navigation with Ctrl-h/j/k/l
map <c-h> <c-w>h
map <c-l> <c-w>l
map <c-k> <c-w>k
map <c-j> <c-w>j

" Resize editor splits with - = _ +
map - <action>(StretchSplitToBottom)
map = <action>(StretchSplitToTop)
map _ <action>(StretchSplitToLeft)
map + <action>(StretchSplitToRight)

" Quick editing/reloading of IdeaVim config
map <Space>eV :edit ~/.ideavimrc<cr>
map <Space>sV :source ~/.ideavimrc<cr>

" VCS / diff / error navigation
map ]c <action>(VcsShowNextChangeMarker)
map [c <action>(VcsShowPrevChangeMarker)
map ]d <action>(NextDiff)
map [d <action>(PreviousDiff)
map ]e <action>(GotoNextError)
map [e <action>(GotoPreviousError)

" Goto navigation (implementation / super / test)
map gi <action>(GotoImplementation)
map gs <action>(GotoSuperMethod)
map gt <action>(GotoTest)
map gT <action>(GotoTest)

" Remap marks to use uppercase registers for convenience
map ma mA
map mb mB
map mc mC
map md mD
map me mE
map mf mF
map mg mG
map mh mH
map mi mI
map mj mJ
map mk mK
map ml mL
map mm mM
map mn mN
map mo mO
map mp mP
map mq mQ
map mr mR
map ms mS
map mt mT
map mu mU
map mv mV
map mw mW
map mx mX
map my mY
map mz mZ
" Same for jumping to marks with '
map 'a 'A
map 'b 'B
map 'c 'C
map 'd 'D
map 'e 'E
map 'f 'F
map 'g 'G
map 'h 'H
map 'i 'I
map 'j 'J
map 'k 'K
map 'l 'L
map 'm 'M
map 'n 'N
map 'o 'O
map 'p 'P
map 'q 'Q
map 'r 'R
map 's 'S
map 't 'T
map 'u 'U
map 'v 'V
map 'w 'W
map 'x 'X
map 'y 'Y
map 'z 'Z

" <leader>. group – IDE / UI toggles & settings
map <leader>.c <action>(ToggleCompactMode)
map <leader>.C <action>(CloseProject)
map <leader>.d <action>(ToggleDistractionFreeMode)
map <leader>.f <action>(ToggleFullScreen)
map <leader>.k <action>(ChangeKeymap)
map <leader>.l <action>(EditorToggleShowLineNumbers)
map <leader>.m <action>(ExternalSystem.ProjectRefreshAction)
map <leader>.p <action>(WelcomeScreen.Plugins)
map <leader>.r <action>(RunConfiguration)
map <leader>.R <action>(RestartIde)
map <leader>.s <action>(SettingsEntryPoint)
map <leader>.t <action>(ViewToolButtons)
map <leader>.v :edit ~/.ideavimrc<cr>
map <leader>.z <action>(ToggleZenMode)

" <leader>a – Activate tool windows
map <leader>ab <action>(ActivateBookmarksToolWindow)
map <leader>aB <action>(ActivateBuildToolWindow)
map <leader>ac <action>(ActivateCommitToolWindow)
map <leader>aC <action>(ActivateCoverageToolWindow)
map <leader>ad <action>(ActivateDebugToolWindow)
map <leader>af <action>(ActivateFindToolWindow)
map <leader>ag <action>(ActivateVersionControlToolWindow)
map <leader>aG <action>(ActivateGradleToolWindow)
map <leader>ah <action>(ActivateHierarchyToolWindow)
map <leader>ai <action>(ActivateAIAssistantToolWindow)
map <leader>ak <action>(TogglePresentationAssistantAction)
map <leader>am <action>(ActivateMavenToolWindow)
map <leader>an <action>(ActivateNotificationsToolWindow)
map <leader>ap <action>(ActivateProjectToolWindow)
map <leader>aP <action>(ActivateProblemsViewToolWindow)
map <leader>ar <action>(ActivateRunToolWindow)
map <leader>as <action>(ActivateStructureToolWindow)
map <leader>aS <action>(ActivateServicesToolWindow)
map <leader>at <action>(ActivateTerminalToolWindow)
map <leader>aT <action>(ActivateTaskToolWindow)
map <leader>av <action>(ActivateVersionControlToolWindow)

" Buffers
nnoremap <leader>1 :buffer 1<CR>
nnoremap <leader>2 :buffer 2<CR>
nnoremap <leader>3 :buffer 3<CR>
map <leader>bO <action>(CloseAllEditorsButActive)
map <leader>b[ :bp<CR>
map <leader>b] :bn<CR>
map <leader>bh :bp<CR>
map <leader>bi :ls<CR>
map <leader>bk :q<CR>
map <leader>bl :bn<CR>
map <leader>bn :bn<CR>
map <leader>bp :bp<CR>

" Education plugin helpers
map <leader>C <action>(Educational.Check)

" Code /clear / close / collapse / config
map <leader>ca <action>(Refactorings.QuickListPopupAction)
map <leader>cd <action>(GotoDeclaration)
map <leader>cf <action>(ReformatCode)
map <leader>ch <action>(CallHierarchy)
map <leader>ci <action>(OptimizeImports)
map <leader>ck <action>(ChangeKeymap)
map <leader>cn <action>(ClearAllNotifications)
map <leader>co <action>(CloseAllEditorsButActive)
map <leader>cp <action>(WelcomeScreen.Plugins)
map <leader>cr <action>(RenameElement)
map <leader>cs <action>(SettingsEntryPoint)
map <leader>cv :edit ~/.ideavimrc<cr>

" Debug / run mappings
map <leader>db <action>(Debug)
map <leader>dd <action>(ContextDebug)
map <leader>de <action>(Debug)
" Clear all marks
map <leader>dm :delmarks 0-9A-Z<cr>

" <leader>e – extract / edit / expand
map <leader>eI <action>(ShowSettings)
map <leader>eP <action>(ShowProjectStructureSettings)
map <leader>eR <action>(editRunConfigurations)
map <leader>eS <action>(ShowSettings)
map <leader>ea <action>(ExpandAllRegions)
map <leader>ec <action>(IntroduceConstant)
map <leader>ef <action>(IntroduceField)
map <leader>ei <action>(ExtractInterface)
map <leader>em <action>(ExtractMethod)
map <leader>ep <action>(IntroduceParameter)
map <leader>er <action>(ExpandRegion)
map <leader>ev <action>(IntroduceVariable)

" <leader>f – find / format
map <leader>fe <action>(RevealIn)
map <leader>ff <action>(FindInPath)
map <leader>fi <action>(Find)
map <leader>fm <action>(ReformatCode)
map <leader>fn <action>(NewElement)
map <leader>fo <action>(ReformatCode)
map <leader>fp <action>(FindInPath)
map <leader>fr <action>(RecentFiles)
map <leader>fs <action>(ToggleFullScreen)
map <leader>fu <action>(FindUsages)

" <leader>g – Git / goto / generate
map <leader>gP <action>(Vcs.Push)
map <leader>gT <action>(GotoTest)
map <leader>ga <action>(Git.Add)
map <leader>gb <action>(Annotate)
map <leader>gc <action>(CheckinProject)
map <leader>ge <action>(Generate)
map <leader>gf <action>(Git.Fetch)
map <leader>gg <action>(ActivateVersionControlToolWindow)
map <leader>gh <action>(Vcs.ShowTabbedFileHistory)
map <leader>gi <action>(GotoImplementation)
map <leader>gl <action>(Vcs.Show.Log)
map <leader>gp <action>(Git.Pull)
map <leader>gs <action>(GotoSuperMethod)
map <leader>gt <action>(GotoTest)

" Hide all tool windows
map <leader>h <action>(HideAllWindows)

" <leader>i – introduce / inline / id
map <leader>ic <action>(IntroduceConstant)
map <leader>id <action>(VimFindActionIdAction)
map <leader>if <action>(IntroduceField)
map <leader>il <action>(Inline)
map <leader>im <action>(ImplementMethods)
map <leader>in <action>(Inline)
map <leader>ip <action>(IntroduceParameter)
map <leader>iv <action>(IntroduceVariable)

" Quick docs / implementations
map <leader>jd <action>(QuickJavaDoc)
map <leader>ji <action>(QuickImplementations)

" Change keymap
map <leader>k <action>(ChangeKeymap)

" Local history
map <leader>lh <action>(LocalHistory.ShowHistory)
map <leader>lH <action>(LocalHistory.ShowSelectionHistory)

" Mode
map <leader>mc <action>(ToggleCompactMode)
map <leader>md <action>(ToggleDistractionFreeMode)
map <leader>mf <action>(ToggleFullScreen)
map <leader>mk <action>(TogglePresentationAssistantAction)
map <leader>mp <action>(TogglePresentationAssistantAction)
map <leader>mP <action>(TogglePresentationMode)
map <leader>mt <action>(ViewToolButtons)
map <leader>mT <action>(ViewToolBar)
map <leader>mv <action>(ChangeView)
map <leader>mw <action>(ViewToolBar)
map <leader>mz <action>(ToggleZenMode)

" Education plugin navigation
map <leader>N <action>(Educational.NextTask)

" <leader>n – new (project/file/scratch/etc.)
map <leader>nd <action>(NewDir)
map <leader>ne <action>(NewElement)
map <leader>nf <action>(NewFile)
map <leader>np <action>(NewProject)
map <leader>ns <action>(NewScratchFile)
map <leader>nt <action>(TerminalNewPredefinedSession)

" <leader>o – open / optimize / override
map <leader>oP <action>(OpenFile)
map <leader>ob <action>(OpenInBrowser)
map <leader>oe <action>(RevealIn)
map <leader>of <action>(OpenFile)
map <leader>og <action>(Vcs.Log.OpenAnotherTabInEditor)
map <leader>oi <action>(OptimizeImports)
map <leader>om <action>(OverrideMethods)
map <leader>op <action>(ActivateProjectToolWindow)
map <leader>or <action>(RecentProjectListGroup)
map <leader>ot <action>(Terminal.OpenInTerminal)

" Project/ Popup / parameter info / docs
map <leader>pd <action>(QuickJavaDoc)
map <leader>pf <action>(GotoFile)
map <leader>ph <action>(ShowHoverInfo)
map <leader>pi <action>(QuickImplementations)
map <leader>pm <action>(ShowPopupMenu)
map <leader>pp <action>(ParameterInfo)
map <leader>pr <action>(RunConfiguration)
map <leader>pt <action>(PinActiveTabToggle)

" Quit current window
map <leader>q :q<CR>

" <leader>r – run / refactor / replace
map <leader>rA <action>(RunnerActions)
map <leader>rB <action>(ChangesView.Revert)
map <leader>rC <action>(Coverage)
map <leader>ra <action>(RunAnything)
map <leader>rb <action>(Vcs.RollbackChangedLines)
map <leader>rc <action>(RunCoverage)
map <leader>rd <action>(DebugClass)
map <leader>re <action>(Refactorings.QuickListPopupAction)
map <leader>rf <action>(RecentFiles)
map <leader>ri <action>(RevealIn)
map <leader>rm <action>(RunMenu)
map <leader>rn <action>(RenameElement)
map <leader>ro <action>(ChangesView.Revert)
map <leader>rp <action>(Replace)
map <leader>rr <action>(ContextRun)
map <leader>rs <action>(runShellFileAction)
map <leader>ru <action>(ChooseRunConfiguration)
map <leader>rw <action>(ReplaceInPath)

" <leader>s – search / show / surround
map <leader>sG <action>(ExternalSystem.ProjectRefreshAction)
map <leader>sH <action>(Vcs.ShowTabbedFileHistory)
map <leader>sI <action>(ShowIntentionActions)
map <leader>sa <action>(GotoAction)
map <leader>sc <action>(GotoClass)
map <leader>sd <action>(QuickJavaDoc)
map <leader>se <action>(ShowErrorDescription)
map <leader>sf <action>(GotoFile)
map <leader>sh <action>(ShowHoverInfo)
map <leader>si <action>(QuickImplementations)
map <leader>sk <action>(TogglePresentationAssistantAction)
" Debug stepping
map <leader>sM <action>(ExternalSystem.ProjectRefreshAction)
map <leader>sO <action>(StepOut)
map <leader>sP <action>(ShowPopupMenu)
map <leader>sT <action>(Stop)
map <leader>si <action>(StepInto)
map <leader>sm <action>(ShowPopupMenu)
map <leader>sn <action>(ShowNavBar)
map <leader>so <action>(StepOver)
map <leader>sp <action>(TextSearchAction)
map <leader>sr <action>(ReplaceInPath)
map <leader>ss <action>(GotoSymbol)
map <leader>st <action>(TextSearchAction)
map <leader>su <action>(ShowUsages)
map <leader>sv :source ~/.ideavimrc<cr>
map <leader>sw <action>(SurroundWith)

" <leader>t – toggles / tabs / breakpoints
map <leader>tb <action>(ToggleLineBreakpoint)
map <leader>tc <action>(ToggleCompactMode)
map <leader>tf <action>(ToggleFullScreen)
map <leader>th :tabm<Space>-<CR>
map <leader>tk <action>(TogglePresentationAssistantAction)
map <leader>tl :tabm<Space>+<CR>
map <leader>tt <action>(ViewToolButtons)
map <leader>tv <action>(VimPluginToggle)
map <leader>tz <action>(ToggleZenMode)

" <leader>u – unwrap / pin tab
map <leader>up <action>(PinActiveTabToggle)
map <leader>uw <action>(Unwrap)

" <leader>v – VCS
map <leader>vb <action>(ViewBreakpoints)
map <leader>vc <action>(CheckinProject)
map <leader>vh <action>(Vcs.ShowTabbedFileHistory)
map <leader>vl <action>(Vcs.Show.Log)
map <leader>vp <action>(Git.Pull)
map <leader>vP <action>(Vcs.Push)

" <leader>w – windows
map <leader>wc :q<CR>
map <leader>wh <c-w>h
map <leader>wj <c-w>j
map <leader>wk <c-w>k
map <leader>wl <c-w>l
map <leader>wq :q<CR>
map <leader>ws :sp<CR>
map <leader>wv :vs<CR>

" Show intention actions
map <leader><cr> <action>(ShowIntentionActions)

" Quick buffer switch: double leader jumps to alternate file
map <leader><leader> <c-^>

" Comment / uncomment current line or selection
map <leader>/ <action>(CommentByLineComment)

" Education plugin mappings
map <leader>C <action>(Educational.Check)
map <leader>N <action>(Educational.NextTask)
map <leader>P <action>(Educational.PreviousTask)
map <leader>R <action>(Educational.RefreshTask)

" Cycle editor tabs with Tab / Shift-Tab
map <s-tab> <action>(PreviousTab)
map <tab> <action>(NextTab)

" Visual-mode surround shorthands for common delimiters
vmap ` S`
vmap ' S'
vmap " S"
vmap ( S(
vmap ) S(
vmap [ S[
vmap ] S[
vmap { S{
vmap } S}
